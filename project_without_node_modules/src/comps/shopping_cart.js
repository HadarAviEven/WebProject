import React, { Component } from 'react';
import { Link } from "react-router-dom";

class ShoppingCart extends Component {
    state = { objects: [] };

    componentDidMount() {
        let temp_ar = [];
        let keys = Object.keys(localStorage);
        for (let key of keys) {
            temp_ar.push(localStorage.getItem(key));
        }
        console.log(temp_ar);
        this.setState({ objects: temp_ar });
    }

    renderTableData() {
        let item_number = 1;
        return this.state.objects.map((item) => {
            return (
                <tr key={item}>
                    <td>{item_number++}</td>
                    <td>{item}</td>
                    <td>
                        <button onClick={() => this.handleDelete(item)} className="btn btn-danger">Delete</button>
                    </td>
                </tr>
            )
        })
    }

    handleDelete(item) {
        localStorage.removeItem(item);

        let temp_ar = [];
        let keys = Object.keys(localStorage);
        for (let key of keys) {
            temp_ar.push(localStorage.getItem(key));
        }
        console.log(temp_ar);
        this.setState({ objects: temp_ar });
    }

    render() {
        return (
            <div >
                <div className="container-fluid bg-secondary p-4">
                    <div className="container">
                        {(this.state.objects.length > 0) ?
                            <div>
                                <table className="table table-striped table-dark">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Item</th>
                                            <th>Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {this.renderTableData()}
                                    </tbody>
                                </table>
                                <Link to="/payment">
                                    <button className="btn btn-warning px-4 m-2 text-white font-weight-bold">Confirm and Pay</button>
                                </Link>
                            </div>
                            :
                            <div className="p-3 text-warning">
                                <h3>Your shopping cart is empty...</h3>
                                <Link to="/" className="text-decoration-none h3">Start shopping now!</Link>
                            </div>}
                    </div>
                </div >
            </div >
        );
    }
}
export default ShoppingCart;